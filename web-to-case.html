<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Prueba de API en Vivo</title>
    <style>
        body { font-family: sans-serif; margin: 2em; max-width: 600px; }
        label { display: block; margin-top: 15px; font-weight: bold; }
        select { width: 100%; padding: 8px; margin-top: 5px; }
        #recommendation-box { margin-top: 10px; padding: 10px; background-color: #f4f4f4; border-left: 3px solid #007bff; min-height: 20px; }
    </style>
</head>
<body>

    <h1>Prueba de Conexión a API de Salesforce</h1>
    <p>Este formulario intenta conectarse a la API en vivo y poblar los menús.</p>

    <label for="category-select">Categoría:</label>
    <select id="category-select">
        <option value="">Llamando a Salesforce...</option>
    </select>

    <div id="recommendation-box"></div>

    <label for="question-select">Pregunta Específica:</label>
    <select id="question-select">
        <option value="">Selecciona una categoría primero</option>
    </select>

<script>
    // --- CONFIGURACIÓN ---
    // Esta es la URL real de tu API de Salesforce.
    const apiUrl = 'https://crossborderxpressmx--dev.sandbox.my.site.com/apipublica/services/apexrest/PreguntasFAQ';

    let faqData = {}; // Variable para guardar los datos

    // --- REFERENCIAS A ELEMENTOS DEL HTML ---
    const categorySelect = document.getElementById('category-select');
    const questionSelect = document.getElementById('question-select');
    const recommendationBox = document.getElementById('recommendation-box');

    // --- LÓGICA PRINCIPAL ---
    document.addEventListener('DOMContentLoaded', fetchFaqData);
    categorySelect.addEventListener('change', handleCategoryChange);

    // --- FUNCIONES ---
    async function fetchFaqData() {
        console.log("Intentando llamar a la API en:", apiUrl);
        try {
            const response = await fetch(apiUrl);
            if (!response.ok) {
                throw new Error(`Error de red: ${response.status} ${response.statusText}`);
            }
            faqData = await response.json();
            console.log("¡Éxito! Datos recibidos:", faqData);
            populateCategories('es');
        } catch (error) {
            console.error("ERROR CRÍTICO AL LLAMAR A LA API:", error);
            categorySelect.innerHTML = '<option value="">Fallo la conexión a la API</option>';
            alert("No se pudo conectar a Salesforce. Revisa la consola (F12) para ver el error de CORS.");
        }
    }

    function populateCategories(lang) {
        console.log("Poblando categorías...");
        categorySelect.innerHTML = `<option value="">-- Selecciona una categoría --</option>`;
        const categories = faqData[lang];
        for (const categoryName in categories) {
            const option = document.createElement('option');
            option.value = categoryName;
            option.textContent = categoryName;
            categorySelect.appendChild(option);
        }
        console.log("Categorías pobladas.");
    }

    function handleCategoryChange() {
        const selectedCategory = categorySelect.value;
        const lang = 'es';
        if (selectedCategory && faqData[lang] && faqData[lang][selectedCategory]) {
            const categoryData = faqData[lang][selectedCategory];
            displayRecommendation(categoryData.recommendation);
            populateQuestions(categoryData.questions);
        } else {
            displayRecommendation('');
            populateQuestions([]);
        }
    }

    function displayRecommendation(text) {
        recommendationBox.textContent = text || '';
    }

    function populateQuestions(questions) {
        questionSelect.innerHTML = `<option value="">-- Selecciona una pregunta --</option>`;
        if (questions && questions.length > 0) {
            questions.forEach(q => {
                const option = document.createElement('option');
                option.value = q.question;
                option.textContent = q.question;
                questionSelect.appendChild(option);
            });
        }
    }
</script>
</body>
</html>