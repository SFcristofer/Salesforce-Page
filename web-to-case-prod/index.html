<!DOCTYPE html>
<html lang="es">

<head>
       
    <meta http-equiv="Content-type" content="text/html; charset=UTF-8">
        <title>Formulario de Soporte Dinámico (con Diagnóstico)</title>
        <style>
        body {
            font-family: sans-serif;
            margin: 2em;
            max-width: 600px;
        }

        label {
            display: inline-block;
            width: 180px;
            margin-top: 12px;
            vertical-align: top;
        }

        input[type="text"],
        select,
        textarea {
            width: 300px;
            padding: 5px;
            box-sizing: border-box;
        }

        textarea {
            height: 100px;
        }

        #recommendation-box {
            margin-left: 180px;
            margin-top: 5px;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f4f4f4;
            border-left: 3px solid #007bff;
            max-width: 300px;
            min-height: 20px;
        }

        input[type="submit"] {
            margin-top: 20px;
            margin-left: 180px;
            padding: 10px 20px;
            cursor: pointer;
        }
    </style>
</head>

<body>

        <h1>Formulario de Contacto</h1>
        <p>Por favor, completa el siguiente formulario para ayudarnos a resolver tu duda.</p>

            <form action="https://webto.salesforce.com/servlet/servlet.WebToCase?encoding=UTF-8&orgId=00DKj00000EAUqM"
        method="POST">

                <input type="hidden" name="orgid" value="00DKj00000EAUqM">
                <input type="hidden" name="retURL" value="http://">

                <label for="name">Nombre del contacto:</label>
                <input id="name" name="name" type="text" required><br>

                <label for="email">Email:</label>
                <input id="email" name="email" type="text" required><br>

                <label for="phone">Teléfono:</label>
                <input id="phone" name="phone" type="text"><br>
               
                        <label for="category-select">Categoría:</label>
                <select id="category-select" name="00NKj00001MkenT" required>
                        <option value="">Cargando...</option>
                    </select><br>

                <div id="recommendation-box"></div>

                        <label for="question-select">Pregunta Específica:</label>
                <select id="question-select" name="00NKj00001MkenU" required>
                        <option value="">Selecciona una categoría primero</option>
                    </select><br>

                <label for="subject">Asunto:</label>
                <input id="subject" name="subject" type="text" required><br>

                <label for="description">Descripción:</label>
                <textarea id="description" name="description"></textarea><br>

                        <label for="00NKj00001MkenJ">Los 4 ultimos digitos:</label>
                <input id="00NKj00001MkenJ" name="00NKj00001MkenJ" type="text"><br>

                <label for="00NKj00001MkenH">Fecha de compra:</label>
                <input id="00NKj00001MkenH" name="00NKj00001MkenH" type="text"><br>

                <label for="00NKj00001MkenE">Codigo postal:</label>
                <input id="00NKj00001MkenE" name="00NKj00001MkenE" type="text"><br>

                <label for="00NKj00001MkenM">Numero de boleto:</label>
                <input id="00NKj00001MkenM" name="00NKj00001MkenM" type="text"><br>

                <label for="00NKj00001MkenN">Número de reservación:</label>
                <input id="00NKj00001MkenN" name="00NKj00001MkenN" type="text"><br>

                <label for="00NKj00001MkenI">Fecha de viaje:</label>
                <input id="00NKj00001MkenI" name="00NKj00001MkenI" type="text"><br>

                <label for="00NKj00001MkenP">RFC:</label>
                <input id="00NKj00001MkenP" name="00NKj00001MkenP" type="text"><br>

                <label for="00NKj00001MkenK">Nombre o Razón Social:</label>
                <input id="00NKj00001MkenK" name="00NKj00001MkenK" type="text"><br>

                        <input type="hidden" id="external" name="external" value="1" /><br>

                <br>
                <input type="submit" name="submit" value="Enviar">
            </form>
       
           
    <script>
        // --- CONFIGURACIÓN ---
        const apiUrl = 'https://crossborderxpressmx.my.site.com/apipublica/services/apexrest/PreguntasFAQ';
        let faqData = {};

        // --- REFERENCIAS A ELEMENTOS DEL HTML ---
        const categorySelect = document.getElementById('category-select');
        const questionSelect = document.getElementById('question-select');
        const recommendationBox = document.getElementById('recommendation-box');

        // --- LÓGICA PRINCIPAL ---
        document.addEventListener('DOMContentLoaded', fetchFaqData);
        categorySelect.addEventListener('change', handleCategoryChange);

        // --- FUNCIONES ---
        async function fetchFaqData() {
            // CONSOLE 1: Verificamos que la función se inicia.
            console.log("1. Iniciando la obtención de datos...");
            try {
                const response = await fetch(apiUrl);
                // CONSOLE 2: Verificamos el estado de la respuesta de la red.
                console.log("2. Respuesta de la red recibida. Estado:", response.status);
                if (!response.ok) throw new Error(`Error de red: ${response.status}`);

                faqData = await response.json();
                // CONSOLE 3: Verificamos los datos ya convertidos a objeto JavaScript.
                console.log("3. Datos convertidos a JSON:", faqData);

                populateCategories('es');
            } catch (error) {
                // CONSOLE 4: Si algo falla, se mostrará aquí.
                console.error("4. ERROR CRÍTICO:", error);
                categorySelect.innerHTML = '<option value="">Fallo la conexión a la API</option>';
            }
        }

        function populateCategories(lang) {
            // CONSOLE 5: Verificamos que entramos a la función de poblar.
            console.log("5. Intentando poblar categorías para el idioma:", lang);
            categorySelect.innerHTML = `<option value="">-- Selecciona una categoría --</option>`;
            const categoriesList = faqData[lang];

            if (!categoriesList) {
                // CONSOLE 6: Si no se encuentra la lista de categorías, lo sabremos.
                console.error("6. ERROR: No se encontró la lista de categorías para el idioma '" + lang + "'.", faqData);
                return;
            }

            // CONSOLE 7: Verificamos que la lista de categorías es un array y tiene contenido.
            console.log(`7. La lista de categorías tiene ${categoriesList.length} elementos.`);

            categoriesList.forEach(category => {
                // CONSOLE 8: Verificamos cada categoría que se va a agregar.
                console.log("8. Agregando la opción:", category.categoryName);
                const option = document.createElement('option');
                option.value = category.categoryName;
                option.textContent = category.categoryName;
                categorySelect.appendChild(option);
            });
        }

        function handleCategoryChange() {
            const selectedCategoryName = categorySelect.value;
            const lang = 'es';
            if (selectedCategoryName) {
                const categoryData = faqData[lang].find(cat => cat.categoryName === selectedCategoryName);
                if (categoryData) {
                    displayRecommendation(categoryData.recommendation);
                    populateQuestions(categoryData.questions);
                }
            } else {
                displayRecommendation('');
                populateQuestions([]);
            }
        }

        function displayRecommendation(text) {
            recommendationBox.textContent = text || '';
        }

        function populateQuestions(questions) {
            questionSelect.innerHTML = `<option value="">-- Selecciona una pregunta --</option>`;
            if (questions && questions.length > 0) {
                questions.forEach(q => {
                    const option = document.createElement('option');
                    option.value = q.question;
                    option.textContent = q.question;
                    questionSelect.appendChild(option);
                });
            }
        }
    </script>    
</body>

</html>