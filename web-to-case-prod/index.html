<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=UTF-8">
    <title>Prueba de API Final</title>
    <style>
        body { font-family: sans-serif; margin: 2em; max-width: 600px; }
        label { display: block; margin-top: 15px; font-weight: bold; }
        select, input[type=text], textarea { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; }
        #recommendation-box { margin-top: 10px; padding: 10px; background-color: #f4f4f4; border-left: 3px solid #007bff; min-height: 20px; }
        
        /* Style the tab */
        .tab {
          overflow: hidden;
          border: 1px solid #ccc;
          background-color: #f1f1f1;
        }

        /* Style the buttons inside the tab */
        .tab button {
          background-color: inherit;
          float: left;
          border: none;
          outline: none;
          cursor: pointer;
          padding: 14px 16px;
          transition: 0.3s;
        }

        /* Change background color of buttons on hover */
        .tab button:hover {
          background-color: #ddd;
        }

        /* Create an active/current tablink class */
        .tab button.active {
          background-color: #ccc;
        }

        /* Style the tab content */
        .tabcontent {
          display: none;
          padding: 6px 12px;
          border: 1px solid #ccc;
          border-top: none;
        }
    </style>
</head>
<body>
    <div class="tab">
      <button class="tablinks" onclick="openTab(event, 'Dev')">Desarrollo</button>
      <button class="tablinks" onclick="openTab(event, 'Prod')">Producción</button>
    </div>

    <div id="Dev" class="tabcontent">
      <h3>Desarrollo (FAQs)</h3>
        <h1>Prueba de Conexión Final</h1>
        <label for="category-select">Categoría:</label>
        <select id="category-select"><option value="">Llamando a Salesforce...</option></select>
        <div id="recommendation-box"></div>
        <label for="question-select">Pregunta Específica:</label>
        <select id="question-select"><option value="">Selecciona una categoría primero</option></select>
    </div>

    <div id="Prod" class="tabcontent">
      <h3>Producción (Web-to-Case)</h3>
        <form action="https://webto.salesforce.com/servlet/servlet.WebToCase?encoding=UTF-8&orgId=00DKj00000EAUqM" method="POST">
 
        <input type=hidden name="orgid" value="00DKj00000EAUqM">
        <input type=hidden name="retURL" value="http://">
         
        <label for="name">Nombre del contacto</label><input  id="name" maxlength="80" name="name" size="20" type="text" /><br>
         
        <label for="email">Email</label><input  id="email" maxlength="80" name="email" size="20" type="text" /><br>
         
        <label for="phone">Teléfono</label><input  id="phone" maxlength="40" name="phone" size="20" type="text" /><br>
         
        <label for="subject">Asunto</label><input  id="subject" maxlength="80" name="subject" size="20" type="text" /><br>
         
        <label for="description">Descripción</label><textarea name="description"></textarea><br>
         
        <label for="prod-category-select">Categoría:</label>
        <select id="prod-category-select" name="00NKj00001MkenT"><option value="">Cargando...</option></select><br>

        <div id="prod-recommendation-box" style="margin-top: 10px; padding: 10px; background-color: #f4f4f4; border-left: 3px solid #007bff; min-height: 20px;"></div>

        <label for="prod-question-select">Pregunta Específica:</label>
        <select id="prod-question-select" name="00NKj00001MkenU"><option value="">Selecciona una categoría primero</option></select><br>
         
        Fecha de compra:<span class="dateInput dateOnlyInput"><input  id="00NKj00001MkenH" name="00NKj00001MkenH" size="12" type="text" /></span><br>
         
        Los 4 ultimos digitos:<input  id="00NKj00001MkenJ" maxlength="18" name="00NKj00001MkenJ" size="20" type="text" /><br>
         
        Codigo postal:<input  id="00NKj00001MkenE" maxlength="255" name="00NKj00001MkenE" size="20" type="text" /><br>
         
        Fecha de viaje:<span class="dateInput dateOnlyInput"><input  id="00NKj00001MkenI" name="00NKj00001MkenI" size="12" type="text" /></span><br>
         
        RFC:<input  id="00NKj00001MkenP" maxlength="255" name="00NKj00001MkenP" size="20" type="text" /><br>
         
        Número de reservación:<input  id="00NKj00001MkenN" maxlength="255" name="00NKj00001MkenN" size="20" type="text" /><br>
         
        Numero de boleto:<input  id="00NKj00001MkenM" maxlength="255" name="00NKj00001MkenM" size="20" type="text" /><br>
         
        Nombre o Razón Social:<input  id="00NKj00001MkenK" maxlength="255" name="00NKj00001MkenK" size="20" type="text" /><br>
         
        <input type="hidden"  id="external" name="external" value="1" /><br>
         
        <input type="submit" name="submit">
         
        </form>
    </div>

<script>
    function openTab(evt, tabName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";
    }

    // --- LÓGICA PRINCIPAL ---
    document.addEventListener('DOMContentLoaded', () => {
        // Open the first tab by default
        document.getElementsByClassName('tablinks')[0].click();
        
        // Fetch data for the FAQ viewer
        fetchFaqData();
    });

    // --- CONFIGURACIÓN ---
    const apiUrl = 'https://crossborderxpressmx.my.site.com/apipublica/services/apexrest/PreguntasFAQ';
    let faqData = {};

    // --- REFERENCIAS A ELEMENTOS DEL HTML (PESTAÑA DESARROLLO) ---
    const categorySelect = document.getElementById('category-select');
    const questionSelect = document.getElementById('question-select');
    const recommendationBox = document.getElementById('recommendation-box');

    // --- REFERENCIAS A ELEMENTOS DEL HTML (PESTAÑA PRODUCCIÓN) ---
    const prodCategorySelect = document.getElementById('prod-category-select');
    const prodQuestionSelect = document.getElementById('prod-question-select');
    const prodRecommendationBox = document.getElementById('prod-recommendation-box');


    // --- EVENT LISTENERS ---
    categorySelect.addEventListener('change', handleCategoryChange);
    prodCategorySelect.addEventListener('change', handleProdCategoryChange);

    // --- FUNCIONES ---
    async function fetchFaqData() {
        try {
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error(`Error de red: ${response.status}`);
            
            faqData = await response.json();

            console.log("Datos JSON recibidos y listos para usar:", faqData);

            // Populate both Dev and Prod dropdowns
            populateCategories('es');
            populateProdCategories('es');

        } catch (error) {
            console.error("ERROR CRÍTICO:", error);
            const errorMsg = 'Fallo la conexión o el procesamiento';
            categorySelect.innerHTML = `<option value="">${errorMsg}</option>`;
            prodCategorySelect.innerHTML = `<option value="">${errorMsg}</option>`;
            alert("Hubo un error. Revisa la consola (F12).");
        }
    }

    // --- FUNCIONES PARA PESTAÑA DESARROLLO ---
    function populateCategories(lang) {
        categorySelect.innerHTML = `<option value="">-- Selecciona una categoría --</option>`;
        const categoriesList = faqData[lang];
        
        if (!categoriesList) {
            console.error("Error: No se encontró la llave de idioma '" + lang + "' en los datos recibidos.", faqData);
            return;
        }

        categoriesList.forEach(category => {
            const option = document.createElement('option');
            option.value = category.categoryName;
            option.textContent = category.categoryName;
            categorySelect.appendChild(option);
        });
    }

    function handleCategoryChange() {
        const selectedCategoryName = categorySelect.value;
        if (selectedCategoryName) {
            const categoryData = faqData['es'].find(cat => cat.categoryName === selectedCategoryName);
            if (categoryData) {
                displayRecommendation(categoryData.recommendation);
                populateQuestions(categoryData.questions);
            }
        } else {
            displayRecommendation('');
            populateQuestions([]);
        }
    }

    function displayRecommendation(text) {
        recommendationBox.textContent = text || '';
    }

    function populateQuestions(questions) {
        questionSelect.innerHTML = `<option value="">-- Selecciona una pregunta --</option>`;
        if (questions && questions.length > 0) {
            questions.forEach(q => {
                const option = document.createElement('option');
                option.value = q.question;
                option.textContent = q.question;
                questionSelect.appendChild(option);
            });
        }
    }

    // --- FUNCIONES PARA PESTAÑA PRODUCCIÓN ---
    function populateProdCategories(lang) {
        prodCategorySelect.innerHTML = `<option value="">-- Selecciona una categoría --</option>`;
        const categoriesList = faqData[lang];
        
        if (!categoriesList) {
            console.error("Error: No se encontró la llave de idioma '" + lang + "' en los datos recibidos.", faqData);
            return;
        }

        categoriesList.forEach(category => {
            const option = document.createElement('option');
            option.value = category.categoryName;
            option.textContent = category.categoryName;
            prodCategorySelect.appendChild(option);
        });
    }
    
    function handleProdCategoryChange() {
        const selectedCategoryName = prodCategorySelect.value;
        if (selectedCategoryName) {
            const categoryData = faqData['es'].find(cat => cat.categoryName === selectedCategoryName);
            if (categoryData) {
                displayProdRecommendation(categoryData.recommendation);
                populateProdQuestions(categoryData.questions);
            }
        } else {
            displayProdRecommendation('');
            populateProdQuestions([]);
        }
    }

    function displayProdRecommendation(text) {
        prodRecommendationBox.textContent = text || '';
    }

    function populateProdQuestions(questions) {
        prodQuestionSelect.innerHTML = `<option value="">-- Selecciona una pregunta --</option>`;
        if (questions && questions.length > 0) {
            questions.forEach(q => {
                const option = document.createElement('option');
                option.value = q.question;
                option.textContent = q.question;
                prodQuestionSelect.appendChild(option);
            });
        }
    }
</script>
</body>
</html>