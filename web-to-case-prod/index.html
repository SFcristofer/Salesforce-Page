<!DOCTYPE html>
<html lang="es">

<head>
       
    <meta charset="UTF-8">
       
    <META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=UTF-8">
        <title>Prueba de API Final (Producción CORREGIDO)</title>
        <style>
        body {
            font-family: sans-serif;
            margin: 2em;
            max-width: 600px;
        }

        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
        }

        select,
        input[type=text],
        textarea {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            box-sizing: border-box;
        }

        #recommendation-box,
        #prod-recommendation-box {
            margin-top: 10px;
            padding: 10px;
            background-color: #f4f4f4;
            border-left: 3px solid #007bff;
            min-height: 20px;
        }

        /* Estilos de Pestañas */
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }

        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
        }

        .tab button:hover {
            background-color: #ddd;
        }

        .tab button.active {
            background-color: #ccc;
        }

        .tabcontent {
            display: none;
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-top: none;
        }
    </style>
</head>

<body>
        <div class="tab">
              <button class="tablinks" onclick="openTab(event, 'Dev')">Visor de FAQs</button>
              <button class="tablinks" onclick="openTab(event, 'Prod')">Formulario Producción (Web-to-Case)</button>
            </div>

        <div id="Dev" class="tabcontent">
              <h3>Visor de FAQs (Datos de Producción)</h3>
                <label for="category-select">Categoría:</label>
                <select id="category-select">
            <option value="">Llamando a Salesforce </option>
        </select>
                <div id="recommendation-box"></div>
                <label for="question-select">Pregunta Específica:</label>
                <select id="question-select">
            <option value="">Selecciona una categoría primero</option>
        </select>
            </div>

        <div id="Prod" class="tabcontent">
              <h3>Formulario Producción (Web-to-Case)</h3>
                <form
            action="https://webto.salesforce.com/servlet/servlet.WebToCase?encoding=UTF-8&orgId=00DKj00000EAUqM"
            method="POST">
             
                    <input type="hidden" name="orgid" value="00DKj00000EAUqM">
                    <input type="hidden" name="retURL" value="http://URL-DE-GRACIAS.com">          
                    <label for="name">Nombre del contacto</label><input  id="name" maxlength="80" name="name" size="20"
                type="text" /><br>
                    <label for="email">Email</label><input  id="email" maxlength="80" name="email" size="20"
                type="text" /><br>
                    <label for="phone">Teléfono</label><input  id="phone" maxlength="40" name="phone" size="20"
                type="text" /><br>
                    <label for="subject">Asunto</label><input  id="subject" maxlength="80" name="subject" size="20"
                type="text" /><br>
                    <label for="description">Descripción</label><textarea name="description"></textarea><br>
                   
                    <label for="prod-category-select">Categoría:</label>
                    <select id="prod-category-select" name="00NKj00001MkenT">
                <option value="">Cargando </option>
            </select><br>

                    <div id="prod-recommendation-box"></div>

                    <label for="prod-question-select">Pregunta Específica:</label>
                    <select id="prod-question-select" name="00NKj00001MkenU">
                <option value="">Selecciona una categoría primero</option>
            </select><br>
                   
                    <label>Fecha de compra:</label><input  id="00NKj00001MkenH" name="00NKj00001MkenH" size="12"
                type="text" /><br>
                    <label>Los 4 ultimos digitos:</label><input  id="00NKj00001MkenJ" name="00NKj00001MkenJ" size="20"
                type="text" /><br>
                    <label>Codigo postal:</label><input  id="00NKj00001MkenE" name="00NKj00001MkenE" size="20"
                type="text" /><br>
                   
                    <input type="hidden"  id="external" name="external" value="1" /><br>
                    <input type="submit" name="submit">
                    </form>
            </div>

    <script>
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // --- LÓGICA PRINCIPAL ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementsByClassName('tablinks')[0].click();
            fetchFaqData();
        });

        // --- CONFIGURACIÓN (Apunta a Producción) ---
        const apiUrl = 'https://crossborderxpressmx.my.site.com/apipublica/services/apexrest/PreguntasFAQ';
        let faqData = {};

        // --- REFERENCIAS A ELEMENTOS HTML ---
        const categorySelect = document.getElementById('category-select');
        const questionSelect = document.getElementById('question-select');
        const recommendationBox = document.getElementById('recommendation-box');
        const prodCategorySelect = document.getElementById('prod-category-select');
        const prodQuestionSelect = document.getElementById('prod-question-select');
        const prodRecommendationBox = document.getElementById('prod-recommendation-box');

        // --- EVENT LISTENERS ---
        categorySelect.addEventListener('change', handleCategoryChange);
        prodCategorySelect.addEventListener('change', handleProdCategoryChange);

        // --- FUNCIONES ---
        async function fetchFaqData() {
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error(`Error de red: ${response.status}`);
                faqData = await response.json();
                console.log("Datos JSON de Producción recibidos:", faqData);

                // Populate both dropdowns
                populateCategories('es');
                populateProdCategories('es');

            } catch (error) {
                console.error("ERROR CRÍTICO:", error);
                const errorMsg = 'Fallo la conexión o el procesamiento';
                categorySelect.innerHTML = `<option value="">${errorMsg}</option>`;
                prodCategorySelect.innerHTML = `<option value="">${errorMsg}</option>`;
            }
        }

        // ==========================================================
        // --- INICIO DE CAMBIOS: LÓGICA DE OBJETO ---
        // ==========================================================

        // --- FUNCIONES PARA PESTAÑA VISOR DE FAQS ---
        function populateCategories(lang) {
            categorySelect.innerHTML = `<option value="">-- Selecciona una categoría --</option>`;
            const categories = faqData[lang]; // Espera un OBJETO

            if (!categories) {
                console.error("Error: No se encontró la llave de idioma '" + lang + "' en los datos (Visor).", faqData);
                return;
            }

            // *** CAMBIO CLAVE: Usamos 'for...in' para iterar un Objeto ***
            for (const categoryName in categories) {
                const option = document.createElement('option');
                option.value = categoryName;
                option.textContent = categoryName;
                categorySelect.appendChild(option);
            }
        }

        function handleCategoryChange() {
            const selectedCategoryName = categorySelect.value;
            const lang = 'es';

            // *** CAMBIO CLAVE: Buscamos por llave de Objeto, no con .find() ***
            if (selectedCategoryName && faqData[lang] && faqData[lang][selectedCategoryName]) {
                const categoryData = faqData[lang][selectedCategoryName]; // Acceso directo
                if (categoryData) {
                    displayRecommendation(categoryData.recommendation);
                    populateQuestions(categoryData.questions);
                }
            } else {
                displayRecommendation('');
                populateQuestions([]);
            }
        }

        function displayRecommendation(text) {
            recommendationBox.textContent = text || '';
        }

        function populateQuestions(questions) {
            questionSelect.innerHTML = `<option value="">-- Selecciona una pregunta --</option>`;
            if (questions && questions.length > 0) {
                questions.forEach(q => {
                    const option = document.createElement('option');
                    option.value = q.question;
                    option.textContent = q.question;
                    questionSelect.appendChild(option);
                });
            }
        }

        // --- FUNCIONES PARA PESTAÑA PRODUCCIÓN (Web-to-Case) ---
        function populateProdCategories(lang) {
            prodCategorySelect.innerHTML = `<option value="">-- Selecciona una categoría --</option>`;
            const categories = faqData[lang]; // Espera un OBJETO

            if (!categories) {
                console.error("Error: No se encontró la llave de idioma '" + lang + "' en los datos (Formulario).", faqData);
                return;
            }

            // *** CAMBIO CLAVE: Usamos 'for...in' para iterar un Objeto ***
            for (const categoryName in categories) {
                const option = document.createElement('option');
                option.value = categoryName;
                option.textContent = categoryName;
                prodCategorySelect.appendChild(option);
            }
        }

        function handleProdCategoryChange() {
            const selectedCategoryName = prodCategorySelect.value;
            const lang = 'es';

            // *** CAMBIO CLAVE: Buscamos por llave de Objeto, no con .find() ***
            if (selectedCategoryName && faqData[lang] && faqData[lang][selectedCategoryName]) {
                const categoryData = faqData[lang][selectedCategoryName]; // Acceso directo
                if (categoryData) {
                    displayProdRecommendation(categoryData.recommendation);
                    populateProdQuestions(categoryData.questions);
                }
            } else {
                displayProdRecommendation('');
                populateProdQuestions([]);
            }
        }

        function displayProdRecommendation(text) {
            prodRecommendationBox.textContent = text || '';
        }

        function populateProdQuestions(questions) {
            prodQuestionSelect.innerHTML = `<option value="">-- Selecciona una pregunta --</option>`;
            if (questions && questions.length > 0) {
                questions.forEach(q => {
                    const option = document.createElement('option');
                    option.value = q.question;
                    option.textContent = q.question;
                    prodQuestionSelect.appendChild(option);
                });
            }
        }
        // ==========================================================
        // --- FIN DE CAMBIOS ---
        // ==========================================================
    </script>
</body>

</html>